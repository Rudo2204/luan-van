# See these links:
# - https://github.com/PHPirates/travis-ci-latex-pdf#tectonic-docker
# - https://github.com/japaric/trust
# - https://malramsay.com/post/compiling_latex_on_travis/

dist: bionic
sudo: required
language: generic
services: docker

# TODO: Update the following to install extra dependencies if needed
before_install:
  - sudo apt-get install python-pygments # If you use the minted package
  - sudo apt-get install p7zip-full # If you want to archive your project files
# - sudo apt-get install ghostscript # If you use latex > dvips > ps2pdf
## If you use custom fonts:
# - mkdir $HOME/.fonts
# - cp -a $TRAVIS_BUILD_DIR/src/fonts/. $HOME/.fonts/
# - fc-cache -f -v

install:
  - source ci/texlive/texlive_install.sh

script:
# TODO: Change the following to compile the correct file(s)
  # Texliveonfly will download packages automatically
  # You can use latexmk to automatically handle bibtex and references (recommended)
  - texliveonfly --compiler=latexmk --arguments='-pdf -bibtex -shell-escape -synctex=1 -interaction=nonstopmode' main.tex

  # But you could use any other compiler (pdflatex, bibtex, pdflatex - have to do 2 times)
  # as well instead of latexmk.

## Uncomment the following lines to see the packages installed in travis
after_script:
  - export PATH=/tmp/texlive/bin/x86_64-linux:$PATH
  - tlmgr list --only-installed | grep -oP 'i \K.+?(?=:)'

before_deploy:
  - sh ci/before_deploy.sh

deploy:
  # TODO update `api_key.secure`
  # - Create a `public_repo` GitHub token. Go to: https://github.com/settings/tokens/new
  # - Encrypt it: `travis encrypt 0123456789012345678901234567890123456789 --pro`
  # - Paste the output down here
  api_key:
    secure: "ZC9nljgWk4TZG+TOmO5o5hcitZG5gFyWOZCKqWc9qNad/VYqDc56qtfksumHuH7Xz5SmVS19jAbmV67irAP1pmf2dnxfuaKHN9VKfQjacrKfevnOGLSEvxVJ83dyV5XHsopqDv8fAUz0M0hsmA/77GGhB7udTn4RL+YKPRLjv59NWvaUEjudRIyx2setzPqQcQrMzKTlXAsFsvmCCGSWaY5gT4PVDFXoK6BzWzykR72GPqBL6q97b389SfcICiEYngZrQZ4h8rPAjQZku1lFYGU4kMefO7S797SXoZvVtycXJvb6+MgHlP0TFHVXZtFoMfq96ocWwbXQut7mtM53Rcg1Eh4EbY8vUNTH0guOkJI/8Ph2KXdijqGM7Ew3Iu3bxsJCQaNvPv3jCmPnl9wmZf8SHN9c4aVfL432GgZQuhNeqXi0VRgDvm1BPd7ja1Fe0v2HZVKGGqha2EIqhTJJmShaRt0KA+dtKJEa5Drl+73A0y5tka3Is+I+PZ4RtYdMG1zvlsHE6WSKtb7dFoOAVbfonWvNx/RoUWKe72wwoRhQzGzJju+q0DJxSoxBir0WiFP+4GcVpMtWA15tgYp7r/IpRjlevoGo1WzshLQz1jI8pV+sl43edv3l31RqyqblohlVgRiHIgewBq3Q3gC5Aw/VgBpk0KH4Y+88ezDDTx4="
  # TODO: Make change here to deploy the right artifacts
  file_glob: true
  file:
    - ./*.pdf
    - ./*.7z
  on:
    tags: true
  provider: releases
  skip_cleanup: true

before_cache:
  # Travis can't cache files that are not readable by "others"
  - chmod -R a+r $HOME/.texlive
  - chmod -R a+r /tmp/texlive

cache:
  directories:
    - /tmp/texlive
    - $HOME/.texlive

branches:
  only:
    # release tags
    - /^v\d+\.\d+\.\d+.*$/
    - master

notifications:
  email:
    on_success: never